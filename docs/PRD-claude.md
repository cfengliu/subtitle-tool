# ğŸ“‹ èªéŸ³æœå‹™ Monorepo æ”¹é€  PRD

## 1. é …ç›®èƒŒæ™¯

### ç¾ç‹€
- å·²æœ‰ Whisper STT (èªéŸ³è½‰æ–‡å­—) æœå‹™é‹è¡Œ
- æ¡ç”¨ monorepo æ¶æ§‹ï¼ˆAPI + Frontendï¼‰
- éœ€è¦æ“´å±• TTS (æ–‡å­—è½‰èªéŸ³) åŠŸèƒ½

### ç›®æ¨™
å°‡èªéŸ³æœå‹™æ”¹é€ ç‚ºçµ±ä¸€çš„ monorepo å¹³å°ï¼Œæ”¯æŒ STT å’Œ TTS é›™å‘èªéŸ³è™•ç†èƒ½åŠ›

---

## 2. æ¶æ§‹è¨­è¨ˆ

### 2.1 ç›®éŒ„çµæ§‹
```
speech-services/
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ README.md
â”œâ”€â”€ CHANGELOG.md
â”‚
â”œâ”€â”€ api/                          # Python å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ pytest.ini
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI ä¸»æ‡‰ç”¨
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stt.py           # STT è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ tts.py           # TTS è·¯ç”±ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ workers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ transcribe_worker.py
â”‚   â”‚   â”‚   â””â”€â”€ tts_worker.py    # æ–°å¢
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stt_models.py
â”‚   â”‚   â”‚   â””â”€â”€ tts_models.py    # æ–°å¢
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_utils.py   # å…±ç”¨éŸ³é »è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ file_utils.py
â”‚   â”‚   â”‚   â””â”€â”€ validation.py
â”‚   â”‚   â””â”€â”€ cleanup_service.py
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ test_stt_endpoints.py
â”‚       â”œâ”€â”€ test_tts_endpoints.py # æ–°å¢
â”‚       â””â”€â”€ test_audio_utils.py
â”‚
â”œâ”€â”€ frontend/                     # Next.js å‰ç«¯
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ stt/            # STT é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ tts/            # TTS é é¢ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ dashboard/      # çµ±ä¸€å„€è¡¨æ¿ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ stt/
â”‚   â”‚   â”‚   â”œâ”€â”€ tts/            # æ–°å¢
â”‚   â”‚   â”‚   â””â”€â”€ shared/         # å…±ç”¨çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”‚   â””â”€â”€ AudioContext.tsx # å…±ç”¨éŸ³é »ç‹€æ…‹
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â””â”€â”€ api-client.ts    # çµ±ä¸€ API å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ styles/
â”‚
â”œâ”€â”€ shared/                       # å…±ç”¨ä»£ç¢¼ï¼ˆå¯é¸ï¼‰
â”‚   â”œâ”€â”€ types/                   # TypeScript é¡å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ stt.ts
â”‚   â”‚   â””â”€â”€ tts.ts
â”‚   â””â”€â”€ constants/               # å…±ç”¨å¸¸é‡
â”‚
â””â”€â”€ docs/                        # æ–‡æª”
    â”œâ”€â”€ API.md
    â”œâ”€â”€ DEPLOYMENT.md
    â””â”€â”€ DEVELOPMENT.md
```

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 æ ¸å¿ƒåŠŸèƒ½

#### STT (ç¾æœ‰åŠŸèƒ½ä¿ç•™)
- âœ… éŸ³é »æ–‡ä»¶ä¸Šå‚³
- âœ… Whisper æ¨¡å‹è½‰éŒ„
- âœ… æ”¯æŒå¤šèªè¨€
- âœ… WebSocket å¯¦æ™‚é€²åº¦

#### TTS (æ–°å¢åŠŸèƒ½)
- ğŸ†• æ–‡å­—è½‰èªéŸ³
- ğŸ†• å¤šç¨®è²éŸ³é¸æ“‡
- ğŸ†• èªé€Ÿã€éŸ³èª¿æ§åˆ¶
- ğŸ†• æ”¯æŒ SSML æ¨™è¨˜
- ğŸ†• éŸ³é »æ ¼å¼é¸æ“‡ (MP3/WAV/OGG)

#### å…±ç”¨åŠŸèƒ½
- ğŸ†• çµ±ä¸€çš„æ–‡ä»¶ç®¡ç†
- ğŸ†• ä»»å‹™éšŠåˆ—å’Œç‹€æ…‹è¿½è¹¤
- ğŸ†• ä½¿ç”¨é‡çµ±è¨ˆå„€è¡¨æ¿
- ğŸ†• éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

### 3.2 å‰ç«¯åŠŸèƒ½

```
Dashboard (æ–°å¢)
â”œâ”€â”€ æœå‹™ç¸½è¦½
â”œâ”€â”€ ä½¿ç”¨çµ±è¨ˆ
â””â”€â”€ æœ€è¿‘ä»»å‹™

STT é é¢
â”œâ”€â”€ æ–‡ä»¶ä¸Šå‚³å€
â”œâ”€â”€ å¯¦æ™‚è½‰éŒ„é¡¯ç¤º
â””â”€â”€ çµæœä¸‹è¼‰

TTS é é¢ (æ–°å¢)
â”œâ”€â”€ æ–‡å­—è¼¸å…¥å€
â”œâ”€â”€ è²éŸ³åƒæ•¸è¨­ç½®
â”œâ”€â”€ å³æ™‚é è½
â””â”€â”€ éŸ³é »ä¸‹è¼‰
```

---

## 4. æŠ€è¡“è¦æ ¼

### 4.1 API ç«¯é»è¨­è¨ˆ

#### STT API (ç¾æœ‰)
```python
POST   /api/v1/stt/transcribe      # è½‰éŒ„éŸ³é »
GET    /api/v1/stt/status/{job_id} # æŸ¥è©¢ç‹€æ…‹
GET    /api/v1/stt/result/{job_id} # ç²å–çµæœ
WS     /api/v1/stt/ws/{job_id}     # WebSocket é€£æ¥
```

#### TTS API (æ–°å¢)
```python
POST   /api/v1/tts/synthesize      # åˆæˆèªéŸ³
GET    /api/v1/tts/status/{job_id} # æŸ¥è©¢ç‹€æ…‹
GET    /api/v1/tts/audio/{job_id}  # ä¸‹è¼‰éŸ³é »
GET    /api/v1/tts/voices           # ç²å–å¯ç”¨è²éŸ³åˆ—è¡¨
```

#### å…±ç”¨ API
```python
GET    /api/v1/health              # å¥åº·æª¢æŸ¥
GET    /api/v1/stats               # ä½¿ç”¨çµ±è¨ˆ
DELETE /api/v1/cleanup             # æ¸…ç†è‡¨æ™‚æ–‡ä»¶
```

### 4.2 æ•¸æ“šæ¨¡å‹

#### TTS Request (æ–°å¢)
```python
class TTSRequest(BaseModel):
    text: str
    voice: str = "default"
    speed: float = 1.0        # 0.5 - 2.0
    pitch: float = 1.0        # 0.5 - 2.0
    format: str = "mp3"       # mp3/wav/ogg
    ssml: bool = False        # æ˜¯å¦ä½¿ç”¨ SSML
```

#### Job Status (çµ±ä¸€)
```python
class JobStatus(BaseModel):
    job_id: str
    type: str                 # "stt" or "tts"
    status: str              # pending/processing/completed/failed
    progress: float          # 0-100
    created_at: datetime
    completed_at: Optional[datetime]
    result_url: Optional[str]
    error: Optional[str]
```

### 4.3 æŠ€è¡“é¸å‹

**å¾Œç«¯**
- FastAPI (ç¾æœ‰)
- Celery/RQ (ä»»å‹™éšŠåˆ—) - æ–°å¢
- Redis (å¿«å– & éšŠåˆ—) - æ–°å¢
- TTS å¼•æ“é¸æ“‡ï¼š
  - Option 1: Coqui TTS (é–‹æº)
  - Option 2: ElevenLabs API (å•†æ¥­)
  - Option 3: Azure TTS (ç©©å®š)

**å‰ç«¯**
- Next.js 15 (ç¾æœ‰)
- shadcn/ui (ç¾æœ‰)
- Zustand (ç‹€æ…‹ç®¡ç†) - æ–°å¢
- React Query (API ç‹€æ…‹) - æ–°å¢

---

## 5. å¯¦æ–½è¨ˆåŠƒ

### Phase 1: åŸºç¤æ¶æ§‹ (Week 1)
- [ ] é‡æ§‹ API ç›®éŒ„çµæ§‹
- [ ] å»ºç«‹ routers æ¨¡å¡ŠåŒ–æ¶æ§‹
- [ ] è¨­ç½® Redis å’Œä»»å‹™éšŠåˆ—
- [ ] çµ±ä¸€é…ç½®ç®¡ç†

### Phase 2: TTS å¾Œç«¯ (Week 2)
- [ ] å¯¦ç¾ TTS router å’Œ endpoints
- [ ] é–‹ç™¼ TTS worker
- [ ] éŸ³é »ç”Ÿæˆå’Œæ ¼å¼è½‰æ›
- [ ] ç·¨å¯«å–®å…ƒæ¸¬è©¦

### Phase 3: å‰ç«¯æ•´åˆ (Week 3)
- [ ] å»ºç«‹ TTS é é¢å’Œçµ„ä»¶
- [ ] å¯¦ç¾çµ±ä¸€ Dashboard
- [ ] å…±ç”¨çµ„ä»¶æŠ½å–
- [ ] API å®¢æˆ¶ç«¯çµ±ä¸€

### Phase 4: å„ªåŒ–å’Œæ¸¬è©¦ (Week 4)
- [ ] æ€§èƒ½å„ªåŒ–
- [ ] ç«¯åˆ°ç«¯æ¸¬è©¦
- [ ] æ–‡æª”å®Œå–„
- [ ] éƒ¨ç½²æº–å‚™

---

## 6. æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™
- âœ… API éŸ¿æ‡‰æ™‚é–“ < 200ms (éè™•ç†æ¥å£)
- âœ… TTS ç”Ÿæˆæ™‚é–“ < 5s (100 å­—ä»¥å…§)
- âœ… æ¸¬è©¦è¦†è“‹ç‡ > 80%
- âœ… éŒ¯èª¤ç‡ < 1%

### é–‹ç™¼æŒ‡æ¨™
- âœ… ä»£ç¢¼å¾©ç”¨ç‡ > 30%
- âœ… éƒ¨ç½²æ™‚é–“ < 10 åˆ†é˜
- âœ… æ–°åŠŸèƒ½é–‹ç™¼é€±æœŸç¸®çŸ­ 40%

---

## 7. é¢¨éšªå’ŒæŒ‘æˆ°

### æŠ€è¡“é¢¨éšª
1. **TTS æ¨¡å‹é¸æ“‡**
   - ç·©è§£ï¼šå…ˆåš POC æ¯”è¼ƒä¸åŒæ–¹æ¡ˆ
   
2. **ä»»å‹™éšŠåˆ—ç©©å®šæ€§**
   - ç·©è§£ï¼šå¯¦ç¾é‡è©¦æ©Ÿåˆ¶å’Œç›£æ§

3. **éŸ³é »æ–‡ä»¶å­˜å„²**
   - ç·©è§£ï¼šå¯¦ç¾è‡ªå‹•æ¸…ç†å’Œ CDN åˆ†ç™¼

### é–‹ç™¼é¢¨éšª
1. **æ¶æ§‹é‡æ§‹å½±éŸ¿ç¾æœ‰åŠŸèƒ½**
   - ç·©è§£ï¼šä¿æŒå‘å¾Œå…¼å®¹ï¼Œåˆ†éšæ®µé·ç§»

2. **å‰å¾Œç«¯åŒæ­¥é–‹ç™¼**
   - ç·©è§£ï¼šå…ˆå®šç¾©æ¸…æ¥š API å¥‘ç´„

---

## 8. ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³é–‹å§‹
1. [ ] æŠ€è¡“é¸å‹ POC (TTS å¼•æ“å°æ¯”)
2. [ ] è¨­è¨ˆè©³ç´° API è¦æ ¼
3. [ ] å»ºç«‹é–‹ç™¼åˆ†æ”¯

### æœ¬é€±å®Œæˆ
1. [ ] Phase 1 åŸºç¤æ¶æ§‹æ­å»º
2. [ ] ç·¨å¯«é–‹ç™¼æ–‡æª”
3. [ ] åœ˜éšŠæŠ€è¡“è©•å¯©

---

**PRD ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-05  
**è² è²¬äºº**: [Your Name]  
**é è¨ˆå®Œæˆ**: 4 é€±å¾Œ